<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Dartmoor Score Sheet</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --moor:#556b4e;
  --parchment:#f4f1ea;
  --stone:#7a6a55;
  --label:#dde4d3;
  --header:#f7f5ef;
  --total:#ece8df;
}

body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--parchment);
}

header{
  background:linear-gradient(#5e6f4e,#4e5f42);
  color:#fff;
  padding:12px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:700;
  font-size:20px;
  gap:12px;
}

.header-buttons{
  display:flex;
  gap:8px;
  align-items:center;
}

button{
  border:1px solid #fff;
  background:transparent;
  color:#fff;
  padding:6px 14px;
  border-radius:6px;
  font-weight:700;
  cursor:pointer;
}

.table-wrap{
  overflow:auto;
  max-height:calc(100vh - 60px);
}

table{
  border-collapse:collapse;
  width:max-content;
  background:#fff;
}

th,td{
  border:2px solid var(--stone);
  text-align:center;
  height:52px;
  font-size:18px;
}

th:not(.label), td:not(.label){
  width:6.5ch;
  min-width:6.5ch;
}

th.label, td.label{
  width:1%;
  white-space:nowrap;
  background:var(--label);
  text-align:left;
  padding:0 12px;
  font-weight:700;
  position:sticky;
  left:0;
  z-index:3;
}

thead th{
  background:var(--header);
  position:sticky;
  top:0;
  z-index:4;
}

thead th.label{
  z-index:5;
  background:var(--label);
}

input.score{
  width:100%;
  height:100%;
  border:none;
  background:transparent;
  text-align:center;
  font-size:20px;
  font-weight:600;
  padding:0;
}

input.name{
  width:100%;
  border:none;
  background:transparent;
  text-align:center;
  font-size:14px;
  font-weight:700;
  padding:0;
}

input:focus{
  outline:none;
  background:#fffdf7;
}

td.total{
  background:var(--total);
  font-size:20px;
  font-weight:900;
}

/* üêë sheep bounce */
@keyframes sheepBounce{
  0%{transform:scale(1);}
  40%{transform:scale(1.25);}
  100%{transform:scale(1);}
}
.sheep-bounce{
  animation:sheepBounce 0.35s ease;
}

/* üéâ toast */
.toast{
  position:fixed;
  bottom:24px;
  left:50%;
  transform:translateX(-50%) translateY(20px);
  background:#2f3b2a;
  color:#fff;
  padding:10px 18px;
  border-radius:999px;
  font-weight:700;
  opacity:0;
  pointer-events:none;
  transition:all .25s ease;
  z-index:999;
}
.toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}

/* History blocks */
.history{
  padding:10px 14px;
  font-size:14px;
  background:#faf8f2;
  border-top:2px solid var(--stone);
}

.round-block{
  margin:8px 0;
  padding:6px 10px;
  background:#fff;
  border:1px solid #cfc6b8;
  border-radius:6px;
  font-size:13px;
}
.round-block strong{
  margin-right:8px;
}
</style>
</head>

<body>

<header>
  <div>Dartmoor ‚Äî Score Sheet</div>
  <div class="header-buttons">
    <button id="addRound">Add Round</button>
    <button id="reset">Reset All</button>
  </div>
</header>

<div class="table-wrap">
<table id="scoreTable">
  <thead>
    <tr>
      <th class="label" style="text-align:center;">
        <span id="sheepIcon" style="font-size:24px; display:block;">üêë</span>
      </th>
      <th><input class="name" placeholder="P1"></th>
      <th><input class="name" placeholder="P2"></th>
      <th><input class="name" placeholder="P3"></th>
      <th><input class="name" placeholder="P4"></th>
      <th><input class="name" placeholder="P5"></th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</div>

<div class="history">
  <strong>Round History</strong>
  <div id="historyTable"></div>
</div>

<div id="toast" class="toast">Round recorded! üêë</div>

<script>
const STORAGE_KEY = "dartmoor-scorepad-v3";
const players = 5;
const tbody = document.querySelector("#scoreTable tbody");
const sheepIcon = document.getElementById("sheepIcon");
const toast = document.getElementById("toast");

function numOrZero(v){
  const n = Number(v);
  return Number.isFinite(n) ? n : 0;
}

const rows = [
  { key:"trees",  label:"Trees" },
  { key:"moors",  label:"Moors" },
  { key:"top",    label:"Top" },
  { key:"bottom", label:"Bottom" },
  { key:"sides",  label:"Left / Right" },
  { key:"cave",   label:"Cave" },
  { key:"total",  label:"Œ£ Total", total:true }
];

const inputsByPlayer = Array.from({length: players}, () => []);
const totalCells = [];
let history = [];

/* build table */
rows.forEach(row=>{
  const tr = document.createElement("tr");

  const label = document.createElement("td");
  label.className = "label";
  label.textContent = row.label;
  tr.appendChild(label);

  for(let p=0; p<players; p++){
    const td = document.createElement("td");

    if(row.total){
      td.className = "total";
      td.textContent = "";
      totalCells[p] = td;
    } else {
      const input = document.createElement("input");
      input.type = "number";
      input.inputMode = "numeric";
      input.className = "score";
      input.value = "";
      input.addEventListener("input", updateTotals);
      td.appendChild(input);
      inputsByPlayer[p].push(input);
    }

    tr.appendChild(td);
  }

  tbody.appendChild(tr);
});

/* totals */
function updateTotals(){
  for(let p=0; p<players; p++){
    let sum = 0;
    let hasValue = false;

    for(const inp of inputsByPlayer[p]){
      if(inp.value !== "") hasValue = true;
      sum += numOrZero(inp.value);
    }

    totalCells[p].textContent =
      (!hasValue && sum === 0) ? "" : String(sum);
  }

  sheepIcon.classList.remove("sheep-bounce");
  void sheepIcon.offsetWidth;
  sheepIcon.classList.add("sheep-bounce");

  saveState();
}

/* helpers */
function getPlayerNames(){
  return [...document.querySelectorAll("input.name")]
    .map((el,i)=> el.value.trim() || `P${i+1}`);
}

function showToast(){
  toast.classList.add("show");
  setTimeout(()=> toast.classList.remove("show"), 1400);
}

/* add round */
function addRound(){
  const totals = totalCells.map(td => td.textContent || "0");
  history.push({ totals });

  // clear scores
  inputsByPlayer.forEach(arr => arr.forEach(i => i.value = ""));

  renderHistory();
  updateTotals();
  saveState();
  showToast();

  // focus first cell
  inputsByPlayer[0][0]?.focus();
}

/* history render */
function renderHistory(){
  const container = document.getElementById("historyTable");

  if(!history.length){
    container.innerHTML = "<em>No rounds recorded.</em>";
    return;
  }

  const names = getPlayerNames();

  container.innerHTML = history.map((round,i)=>{
    const parts = round.totals.map((v,p)=> `${names[p]}: ${v}`);
    return `<div class="round-block"><strong>Round ${i+1}</strong>${parts.join(" ‚Ä¢ ")}</div>`;
  }).join("");
}

/* storage */
function saveState(){
  const data = {
    scores: inputsByPlayer.map(arr=>arr.map(i=>i.value)),
    names: getPlayerNames(),
    history
  };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function loadState(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return;
  try{
    const data = JSON.parse(raw);

    data.scores?.forEach((playerArr,p)=>{
      playerArr.forEach((val,i)=>{
        if(inputsByPlayer[p][i]) inputsByPlayer[p][i].value = val;
      });
    });

    data.names?.forEach((val,i)=>{
      const el = document.querySelectorAll("input.name")[i];
      if(el) el.value = val;
    });

    history = data.history || [];
  }catch{}
}

/* reset */
document.getElementById("reset").onclick = () => {
  if(!confirm("Reset all scores and history?")) return;

  document.querySelectorAll("input.score").forEach(i => i.value = "");
  document.querySelectorAll("input.name").forEach(i => i.value = "");
  history = [];
  renderHistory();
  updateTotals();
  saveState();
};

document.getElementById("addRound").onclick = addRound;

/* init */
loadState();
updateTotals();
renderHistory();
</script>

</body>
</html>
